@model Tree;
@{
    ViewData["Title"] = "Home Page";
}
<style>
    .letter {
        color: red;
        font-size: 200%;
    }
    ol {
        list-style-type: none
    }
</style>
<div>
    <h1 class="display-4">Ступень 1 - Вывести на страницу данные в древовидной форме.</h1>
    @{
        ModuleTree moduleTree = Model.moduleTree;
        foreach (Module root in moduleTree.roots)
        {
            Course course = Model.courses.Where(x => x.id == root.CourseId).FirstOrDefault();
            <hr />
            <h2>@course.Title</h2>
            <hr />
            Stack<Module> stack = new Stack<Module>();
            Dictionary<Module, byte> nodes = moduleTree.adjacencyList.Keys.ToDictionary(x => x, x => (byte)0);

            stack.Push(root);

            List<Module> subNodes;
            moduleTree.ResetNumberOfSubNodesPassed();

            while (stack.Count != 0)
            {

                Module node = stack.Pop();
                nodes[node] = 2;

                Module parent = moduleTree.getParent(node);


                if (moduleTree.firstChild(node))
                {
                    @Html.Raw("<ol>")
                }

                if (node.ParentId is not null)
                {
                    moduleTree.subNodePassed(node);
                }

                <li>
                    <span class="letter">@node.num</span> @node.Title @node.Id
                </li>

                if (moduleTree.lastChild(node))
                {
                    @Html.Raw("</ol>")
                    moduleTree.numberOfSubNodesPassed.Remove(parent);
                }

                subNodes = moduleTree.adjacencyList[node];

                if (subNodes.Count != 0)
                    moduleTree.numberOfSubNodesPassed.Add(node, subNodes.Count);

                subNodes.Reverse();
                foreach (Module item in subNodes)
                {
                    if (nodes[item] == 0)
                    {
                        stack.Push(item);
                        nodes[item] = 1;
                    }
                }
            }
        }
    }
</div>